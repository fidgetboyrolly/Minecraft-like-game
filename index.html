<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Fidget Script Game</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #fileInput { margin: 20px; }
        #canvas { display: none; border: 1px solid #ddd; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Upload Your Fidget Script</h1>
    <input type="file" id="fileInput" accept=".fidscy">
    <canvas id="canvas" width="800" height="600"></canvas>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        document.getElementById('fileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const content = e.target.result;
                    processFidgetScript(content);
                };
                reader.readAsText(file);
            }
        });

        function processFidgetScript(content) {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(content, 'application/xml');

            const display = xmlDoc.querySelector('display');
            const ren = display.querySelector('ren').getAttribute('value');
            const canvas = document.getElementById('canvas');
            canvas.style.display = 'block';

            if (ren === '3D') {
                init3DGame(xmlDoc);
            } else {
                init2DGame(xmlDoc);
            }
        }

        function init3DGame(xmlDoc) {
            // Set up Three.js scene
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas') });
            renderer.setSize(window.innerWidth, window.innerHeight);

            // Create player cube
            const playerGeometry = new THREE.BoxGeometry(1, 1, 1);
            const playerMaterial = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
            const player = new THREE.Mesh(playerGeometry, playerMaterial);
            scene.add(player);

            // Create ground
            const groundGeometry = new THREE.BoxGeometry(10, 0.1, 10);
            const groundMaterial = new THREE.MeshBasicMaterial({ color: 0x888888 });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.position.y = -1;
            scene.add(ground);

            camera.position.z = 5;

            function animate() {
                requestAnimationFrame(animate);
                player.rotation.x += 0.01;
                player.rotation.y += 0.01;
                renderer.render(scene, camera);
            }
            animate();
        }

        function init2DGame(xmlDoc) {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');

            // Player settings
            const player = { x: 400, y: 300, size: 50, color: 'green' };

            // Draw player
            function drawPlayer() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = player.color;
                ctx.fillRect(player.x, player.y, player.size, player.size);
            }
            drawPlayer();
        }
    </script>
</body>
</html>
